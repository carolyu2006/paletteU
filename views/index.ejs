<html>

<head>
    <title>PALETTE U</title>
    <link rel="icon" href="assets/images/logo-transparent.png">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/emotions.css">
    <link rel="stylesheet" href="css/train.css">
    <link rel="stylesheet" href="css/individual-memory.css">
    <script src="js/script.js"></script>
    <script src="js/header.js"></script>

</head>

<body>
    <%- include('components/header-home.ejs') %>

        <section id="emotions-section">
            <% 
            // Helper function to split word
            // Odd length: split in half and delete middle character
            // Even length: split directly in half
            function splitWord(word) {
              if (!word || word.length === 0) return { part1: '', part2: '' };
              const upperWord = word.toUpperCase();
              const length = word.length;
              
              if (length <= 2) return { part1: upperWord, part2: '' };
              
              if (length % 2 === 0) {
                // Even length: split directly in half
                const half = length / 2;
                return {
                  part1: upperWord.substring(0, half),
                  part2: upperWord.substring(half)
                };
              } else {
                // Odd length: take first half, skip middle, take last half
                const half = Math.floor(length / 2);
                return {
                  part1: upperWord.substring(0, half),
                  part2: upperWord.substring(half + 1) // Skip middle character
                };
              }
            }
            
            // Get emotion word parts or use defaults
            const redParts = typeof emotionWords !== 'undefined' && emotionWords && emotionWords.red 
              ? splitWord(emotionWords.red)
              : { part1: 'AN', part2: 'ER' };
            const yellowParts = typeof emotionWords !== 'undefined' && emotionWords && emotionWords.yellow
              ? splitWord(emotionWords.yellow)
              : { part1: 'J', part2: 'OY' };
            const greenParts = typeof emotionWords !== 'undefined' && emotionWords && emotionWords.green
              ? splitWord(emotionWords.green)
              : { part1: 'DIS', part2: 'UST' };
            const blueParts = typeof emotionWords !== 'undefined' && emotionWords && emotionWords.blue
              ? splitWord(emotionWords.blue)
              : { part1: 'SAD', part2: 'ESS' };
            const purpleParts = typeof emotionWords !== 'undefined' && emotionWords && emotionWords.purple
              ? splitWord(emotionWords.purple)
              : { part1: 'FE', part2: 'AR' };
            %>
            <a href="/add-memory?emotion=anger" class="hover-red hover-expand">
                <h1 class="emotion-title"><%= redParts.part1 %></h1>
                <img src="assets/images/emotion/shape/red.svg" alt="anger" class="emotion-image">
                <h1 class="emotion-title"><%= redParts.part2 ? ' ' + redParts.part2 : '' %></h1>
            </a>

            <a href="/add-memory?emotion=joy" class="hover-yellow hover-expand">
                <h1 class="emotion-title"><%= yellowParts.part1 %></h1>
                <img src="assets/images/emotion/shape/yellow.svg" alt="joy" class="emotion-image">
                <h1 class="emotion-title"><%= yellowParts.part2 ? yellowParts.part2 : '' %></h1>
            </a>
            <a href="/add-memory?emotion=disgust" class="hover-green hover-expand">
                <h1 class="emotion-title"><%= greenParts.part1 %></h1>
                <img src="assets/images/emotion/shape/green.svg" alt="disgust" class="emotion-image">
                <h1 class="emotion-title"><%= greenParts.part2 ? greenParts.part2 : '' %></h1>
            </a>
            <a href="/add-memory?emotion=sadness" class="hover-blue hover-expand">
                <h1 class="emotion-title"><%= blueParts.part1 %></h1>
                <img src="assets/images/emotion/shape/blue.svg" alt="sadness" class="emotion-image">
                <h1 class="emotion-title"><%= blueParts.part2 ? blueParts.part2 : '' %></h1>
            </a>
            <a href="/add-memory?emotion=fear" class="hover-purple hover-expand">
                <h1 class="emotion-title"><%= purpleParts.part1 %></h1>
                <img src="assets/images/emotion/shape/purple.svg" alt="fear" class="emotion-image">
                <h1 class="emotion-title"><%= purpleParts.part2 ? purpleParts.part2 : '' %></h1>
            </a>
        </section>

        <div id="train-container" class="train-container">
            <div class="train-wrapper">
                <img src="assets/images/home/train.svg" alt="train" class="train-image">
                <svg width="811" height="232" viewBox="0 0 811 232" class="train-circles-overlay"
                    preserveAspectRatio="xMidYMid meet">
                </svg>
                <% trainMemory.forEach((m, i)=> { %>
                    <button onclick="openMemory(this)" data-memory-id="<%= m._id %>"
                        data-memory-emotion="<%= m.emotion %>" data-memory-title="<%= m.title || '' %>"
                        data-memory-date="<%= m.date || '' %>" data-memory-description="<%= m.description || '' %>"
                        data-memory-imgsrc="<%= Array.isArray(m.imgSrc) ? m.imgSrc[0] : (m.imgSrc || '') %>"
                        data-memory-island="<%= Array.isArray(m.island) ? m.island.join(',') : '' %>"
                        class="train-circle circle<%= i %> bg-<%= m.emotion %>">
                    </button>
                    <% }); %>
            </div>
        </div>

        <div id="train-memory-container" class="train-memory-container">
            <div id="train-memory-display" class="train-memory-display">
                <button class="close-train-memory-btn" onclick="closeTrainMemory()">Ã—</button>
                <div id="train-memory-content" class="train-memory-content">
                    <!-- Memory content will be loaded here -->
                </div>
            </div>
        </div>

</body>

</html>